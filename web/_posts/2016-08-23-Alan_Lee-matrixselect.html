---
author: "Alan Lee"
title: "矩陣的條件式篩選"
tags: ['apply', 'data process', 'matrix']
link: "http://rwepa.blogspot.com/2016/08/matrixselect.html"
---

<h4 style="color: #222222; font-family: arial, tahoma, helvetica, freesans, sans-serif; margin: 0px; position: relative;"><span style="background-color: white; font-family: &quot;courier new&quot;, courier, monospace;">Problem:</span></h4><div><span style="background-color: #cccccc; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span></div>在R的資料處理環境中，有時須先篩選符合條件的資料，再進行後續處理，以下說明如何完成此需求.<br /><br />感謝Ｒ友-Mimi 提供此問題.<br /><br /><h3 style="color: #222222; font-family: arial, tahoma, helvetica, freesans, sans-serif; margin: 0px; position: relative;"><span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: small;">Analysis:</span></h3><div><br /></div><div><span style="background-color: #cccccc;"></span><br /><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><a href="http://1.bp.blogspot.com/-o4s-NzU3DzM/V7u-Ac6G8II/AAAAAAAAKow/-SEcyCxsI1wS9sCl1qslT0Q-B3gfg1ApQCK4B/s1600/matrix_select1.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="151" src="https://1.bp.blogspot.com/-o4s-NzU3DzM/V7u-Ac6G8II/AAAAAAAAKow/-SEcyCxsI1wS9sCl1qslT0Q-B3gfg1ApQCK4B/s400/matrix_select1.png" width="400" /></a></span></div><span style="background-color: #cccccc;"> </span> <br /><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><br /></span></div><span style="background-color: #cccccc;"> </span> <br /><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><br /></span></div><span style="background-color: #cccccc;"> </span> <br /><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><a href="http://1.bp.blogspot.com/-M3lt8aWMRFI/V7u-jJv7DtI/AAAAAAAAKo4/UkTQSghve-IsITGUKOxtqFn1VMFGJOrEQCK4B/s1600/matrix_select2.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="115" src="https://1.bp.blogspot.com/-M3lt8aWMRFI/V7u-jJv7DtI/AAAAAAAAKo4/UkTQSghve-IsITGUKOxtqFn1VMFGJOrEQCK4B/s400/matrix_select2.png" width="400" /></a></span></div><span style="background-color: #cccccc;"> </span><br /><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><br /></span></div><div style="font-family: &quot;courier new&quot;, courier, monospace;"><span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span> <span style="background-color: #cccccc;"><br /></span><span style="background-color: white;">本問題是如何找出同時滿足數值大於或等於0.5, 較辛苦的方法是將所有條件用 AND 運算(&amp;)找出其結果. 實務上可考慮邏輯運算特性, 即 TRUE 表示1, FALSE 表示0, 利用 sum( )函數計算加總為12表示該列所有行滿足條件. 因為是每列都要判斷, 因此採用 apply, 第2個參數設定為1表示列運算. 最後以 which 回傳符合條件之指標.</span></div><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><br /></span></div><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><br /></span></div><div style="font-family: &quot;courier new&quot;, courier, monospace; font-size: small;"><span style="background-color: #cccccc;"><a href="http://1.bp.blogspot.com/-Kj6gX00SgKA/V7vBbAPfWtI/AAAAAAAAKpI/FGUJwlkMZUsWVefVQkwt5OEfjChlsqlPgCK4B/s1600/matrix_select3.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="125" src="https://1.bp.blogspot.com/-Kj6gX00SgKA/V7vBbAPfWtI/AAAAAAAAKpI/FGUJwlkMZUsWVefVQkwt5OEfjChlsqlPgCK4B/s400/matrix_select3.png" width="400" />&nbsp;</a></span></div></div><br /><br /><br /><br /><br /><br /><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># R code</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># 建立矩陣範例 318*12</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">set.seed(123)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">m &lt;- matrix(round(c(runif(318*7), rep(1, 318*5)), 2), ncol=12)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">rownames(m) &lt;- paste0("row", 1:318)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">head(m)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># 條件篩選</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">m.check &lt;- (m &gt;= 0.5)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">head(m.check)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># 如果整列加總=12,表示所該列所有資料行皆符合篩選條件</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">ind &lt;- which(apply(m.check, 1, sum) == 12)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">ind</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">m[ind, ]</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># end</span>
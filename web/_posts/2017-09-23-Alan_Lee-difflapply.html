---
author: "Alan Lee"
title: "R等差數列(前後二個元素相減)與條件式計算"
tags: ['lapply', 'operators']
link: "http://rwepa.blogspot.com/2017/09/difflapply.html"
---

<br />主題: 如何計算數列的前後二個元素相減產生的新等差數列與不同條件式數值計算<br /><br /># diff<br /># c<br /># lapply<br /># &lt;&lt;<br /><br />分析:<br /><ul><li>感謝R友 Bic Ton提供此問題</li><li><span style="font-family: inherit;">考慮 <span style="font-family: &quot;verdana&quot; , sans-serif;">x &lt;- c(2,5,6,1,3,8,4,5,6)</span>, 計算數列中後面減前面之結果, 例: 5-2=3, 6-5=1,...., 此時可以使用 diff(x). &nbsp;diff 函數預設會計算數列中第2個元素減第1個元素的結果. 參閱線上說明 ?diff&nbsp;</span></li><li>如果希望計算前面減後面之結果, 例: 2-5=33, 5-6=-1,...., 此時可以使用 <span style="color: red;">-diff(x)</span></li><li>本例考慮3種不同解法:<br />(1). 使用 for 迴圈判斷等差數列每個元素為正數或負數, 再加總結果.<br />(2). 使用 for 迴圈判斷等差數列每個元素為正數或負數, 將結果用 <span style="color: red;">c()</span> 向量組合成新向量, 此方法可儲存正數與負數之結果. 注意: 本方法因為要儲存新等差數列的結果, 因此執行時間須較久.<br />(3). 使用 lapply 函數以進行不同條件式數值計算, 本例使用全域變數指派符號 <span style="color: red;">&lt;&lt;</span> 以利回傳計算結果.</li><li>本例第2種方法 c() 分別儲存正/負數結果, 如果資料量較大時, 例: 100萬筆資料以上, 其執行時間須很久, 此時須考量其他儲存方式, 例: 使用 list串列 以加速程式之進行.</li></ul><div>R程式碼:</div><div><br /></div><div><pre><code class="language-r line-numbers">x &lt;- c(2,5,6,1,3,8,4,5,6)<br />x.diff &lt;- -diff(x)<br />x.diff<br /># method 1 using for loop<br />gain1 &lt;- 0<br />loss1 &lt;- 0<br />for (i in 1:length(x.diff)) {<br /> if (x.diff[i] &gt;= 0) gain1 &lt;- gain1 + x.diff[i]<br /> else if (x.diff[i] &lt; 0) loss1 &lt;- loss1 + x.diff[i]<br />}<br />gain1<br />loss1<br /><br /># method 2 using for loop with c()<br />gain2 &lt;- c()<br />loss2 &lt;- c()<br />for (i in 1:length(x.diff)) {<br /> if (x.diff[i] &gt;= 0) gain2 &lt;- c(gain2, x.diff[i])<br /> else if (x.diff[i] &lt; 0) loss2 &lt;- c(loss2, x.diff[i])<br />}<br />sum(gain2)<br />sum(loss2)<br /><br /># method 3<br />gain3 &lt;- 0<br />loss3 &lt;- 0<br />lapply(x.diff, function(x) {<br /> ifelse(x &gt; 0, gain3 &lt;&lt;- gain3 + x, loss3 &lt;&lt;- loss3 + x)<br /> #return(c(gain, loss))<br /> })<br />gain3<br />loss3<br /># end</code></pre></div>
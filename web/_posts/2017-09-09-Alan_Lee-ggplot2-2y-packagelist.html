---
author: "Alan Lee"
title: "網路抓取 R CRAN 套件清單, 使用 ggplot2 套件繪圖, 建立第2個y軸座標."
tags: ['data process', 'ggplot2', 'packages', 'scrapping', 'visualization']
link: "http://rwepa.blogspot.com/2017/09/ggplot2-2y-packagelist.html"
---

主題: 網路抓取 R CRAN 套件清單, 使用 ggplot2 套件繪圖, 建立第2個y軸座標.<br />說明:<br /><br /># ggplot2<br /># packages list<br /># XML<br /># geom_col<br /># goem_line<br /># geom_point<br /># scale_y_continuous<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-4aK50VcADgI/WbOQI1BekMI/AAAAAAAAL6Q/CLRU98k2JeobLuoQFKHt1op_ImuhWUR7ACLcBGAs/s1600/%25E7%25AC%25AC2y%25E8%25BB%25B8%25E5%25BA%25A7%25E6%25A8%2599%25E8%25BB%25B8.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="572" data-original-width="684" height="333" src="https://3.bp.blogspot.com/-4aK50VcADgI/WbOQI1BekMI/AAAAAAAAL6Q/CLRU98k2JeobLuoQFKHt1op_ImuhWUR7ACLcBGAs/s400/%25E7%25AC%25AC2y%25E8%25BB%25B8%25E5%25BA%25A7%25E6%25A8%2599%25E8%25BB%25B8.png" width="400" /></a></div><br /><br /><ul><li>[#1-2] 首先載入 XML, ggplot2 套件.</li><li>[#3] 使用CRAN網站-依日期排列抓取現有1萬多個套件清單, <br />例:&nbsp;<a href="http://cran.csie.ntu.edu.tw/web/packages/available_packages_by_date.html" target="_blank">http://cran.csie.ntu.edu.tw/web/packages/available_packages_by_date.html</a></li><li>[#4] 使用 readHTMLTable {XML} 函數以讀取網站中的套件清單表格, 將結果儲存為mydf資料物件.</li><li>[#7] 使用&nbsp;trimws {base} 函數以刪除欄位名稱空白字元.</li><li>[#8] 原匯入第1欄 Date為字串資料型態, 使用 as.Date {base} 轉換為 日期(Date) 資料型態.</li><li>[#9] 使用 format {base}並取出套件更新年, 使用 table {base} 以計算各年套件個數.</li><li>[#10] 使用&nbsp;cumsum {base}計算累計套件數並新增為&nbsp;AccumulatedPAckages 欄位.</li><li>[#11] 使用 names {base} 設定前二欄名稱為 Year, Packages.</li><li>[#14] 使用 geom_col {ggplot2} 繪製"套件數(年)"長條圖, 另可使用&nbsp;geom_bar {ggplot2} 繪製.</li><li>[#15-18] 設定主標題, x軸標題, y軸標題. theme {ggplot2} 可設定標題左右置中.</li><li>[#19] 使用&nbsp;scale_y_continuous {ggplot2}可在繪圖區之右側建立y軸第2座標軸. 右側y軸對應長條圖的刻度. ggplot2 採用資料轉換概念, 因此左側y軸第1座標軸的刻度,對應至累計套件數, 其中最大值約11405, 右側最大值約4502,&nbsp;11405/4502=2.5, 考慮以2倍計算, 即將左側刻度除以2, 轉換為右側刻度, 一般使用 trans = ~. /2 表示.</li><li>[#21] 使用&nbsp;annotate {ggplot2} 可加上文字標題.</li><li>[#22-24] 使用&nbsp;goem_line {ggplot2} 繪製累計套件數線圖.</li><li>[#25-27] 使用&nbsp;goem_point {ggplot2} 繪製累計套件數點圖.</li></ul><br /><pre><code class="language-r line-numbers">library(XML)<br />library(ggplot2)<br />urls &lt;- "http://cran.csie.ntu.edu.tw/web/packages/available_packages_by_date.html"<br />mydf &lt;- readHTMLTable(urls, stringsAsFactors = FALSE)<br />str(mydf)<br />mydf &lt;- mydf[[1]]<br />names(mydf) &lt;- trimws(names(mydf))<br />mydf$Date &lt;- as.Date(mydf$Date)<br />mydf &lt;- data.frame(table(format(mydf$Date, "%Y")), stringsAsFactors=FALSE)<br />mydf$AccumulatedPAckages &lt;- cumsum(mydf$Freq)<br />names(mydf)[1:2] &lt;- c("Year", "Packages")<br />mydf<br />ggplot(mydf, aes(x = Year)) +<br />geom_col(aes(y = Packages*2), fill="grey") + <br />theme(plot.title = element_text(hjust = 0.5)) + <br />xlab("年 (2005.1~2017.9)") + <br />ylab("累計套件數") +<br />ggtitle("CRAN-套件統計圖 - by RWEPA") + <br />scale_y_continuous(sec.axis = sec_axis(trans = ~. /2)) + <br />theme(axis.title.y = element_text(colour = "blue")) + <br />annotate("text", x=13, y=5500, label= "套件數(年)", angle = -90) + <br />geom_line(aes(y = AccumulatedPAckages, group = 1), linetype = 2, color = "blue") +<br />theme(axis.text.x = element_text(face="bold", angle=45),<br />axis.text.y = element_text(face="bold", color="black", size=10)) +<br />geom_point(aes(y = AccumulatedPAckages, group = 1), color = "blue") +<br />geom_text(aes(y = AccumulatedPAckages, label = AccumulatedPAckages), <br />vjust = -0.3, size = 4, color = "blue")<br /># end<br /></code></pre><br /><br />
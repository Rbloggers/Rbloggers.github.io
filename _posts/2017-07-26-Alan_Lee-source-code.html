---
author: "Alan Lee"
title: "函數原始碼 source code"
tags: ['apply', 'lapply', 'rstudio', 'source', 'tutorials']
link: "http://rwepa.blogspot.com/2017/07/source-code.html"
highlight: true
---

R是開放原始碼軟體, 以下說明查詢函數的原始碼的方法(參考 1, 2).<br /><h2>簡介</h2>R函數許多原始檔案包括 C, Fortran等程式碼, 常用呼叫其他已編譯完成程式的函數包括:&nbsp;.C .Call, .Fortran, .External, .Internal, .Primitive 等函數. (參考3 &nbsp;R Internals, 2017).<br /><br />C程式在編譯成R時,可直接經由 primitives(原生) 或 .Internal interface (.內部介面)來呼叫使用, 此方式與 .External interface (.外部介面)類似, 但使用語法不相同.<br /><br />「.Internal」 和 「.Primitive」 一般用於呼叫 C 的介面:<br /><ul><li>.Internal 是標準的用法，在呼叫C之前可以檢查R程式碼中的參數 .</li><li>.Primitive&nbsp;執行效能較高，但不允許在函數中使用R程式.</li></ul>R的原始碼 R-3.4.1.tar.gz (參考4) 解壓縮之後在&nbsp;<span style="font-family: , serif;">「</span>\R-3.4.1.tar\R-3.4.1\src\main<span style="font-family: , serif;">」</span>&nbsp;目錄中存放約121個 *.c 原始碼.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-wObgmICtdBk/WXjAthMBtTI/AAAAAAAALwg/Qp6GhAB0gUgWPWY6UVzjb-6ZyZA5sCaqQCLcBGAs/s1600/%25E5%2587%25BD%25E6%2595%25B8%25E5%258E%259F%25E5%25A7%258B%25E7%25A2%25BCsrc.main.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="494" data-original-width="889" height="221" src="https://3.bp.blogspot.com/-wObgmICtdBk/WXjAthMBtTI/AAAAAAAALwg/Qp6GhAB0gUgWPWY6UVzjb-6ZyZA5sCaqQCLcBGAs/s400/%25E5%2587%25BD%25E6%2595%25B8%25E5%258E%259F%25E5%25A7%258B%25E7%25A2%25BCsrc.main.png" width="400" /></a></div><br /><br /><h2>查詢函數原始碼</h2># 1<br />使用 pryr 套件的 ftype 函數可檢視該函數的種類:<br /><br /><ul><li>regular/primitive/internal function</li><li>internal/S3/S4 generic</li><li>S3/S4/RC method</li></ul><ul></ul><br /><pre><code class="language-r line-numbers">library(pryr)<br />ftype(apply) # "function"</code></pre><br /># 2<br />直接輸入函數名稱, 即可顯示原始檔.<br /><br /><pre><code class="language-r line-numbers">apply</code></pre><div><code class="language-r line-numbers"><br /></code></div><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-22F8E01y4Po/WXiyxZbYDwI/AAAAAAAALwY/KxXFzosEMEQAU4Vpomf4p0eV_E10AFIngCEwYBhgL/s1600/apply.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="439" data-original-width="865" height="202" src="https://2.bp.blogspot.com/-22F8E01y4Po/WXiyxZbYDwI/AAAAAAAALwY/KxXFzosEMEQAU4Vpomf4p0eV_E10AFIngCEwYBhgL/s400/apply.png" width="400" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: left;"></div><div style="clear: both; text-align: left;"># 3</div><div style="clear: both; text-align: left;">在 RStuido 軟體的程式編輯視窗, 選取 apply , 按 CTRL + &nbsp;滑鼠左鍵, 可開啟原始檔.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-vrV6pM0r064/WXitfLrsMGI/AAAAAAAALv8/dKArMR4XDQkqYqh0h9li715gxFWRtoolwCLcBGAs/s1600/apply.view.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="636" data-original-width="948" height="267" src="https://2.bp.blogspot.com/-vrV6pM0r064/WXitfLrsMGI/AAAAAAAALv8/dKArMR4XDQkqYqh0h9li715gxFWRtoolwCLcBGAs/s400/apply.view.png" width="400" /></a></div><br /><br />#4<br />getAnywhere {utils} 可查詢函數隸屬於哪些套件與內容. 使用 show_c_source {pryr}可檢視該函數原始檔.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-0SfuXUnNzQc/WXjDxPfhTpI/AAAAAAAALws/IAMSNAo8178dtDF4OWLd2zPkO52S3POkQCLcBGAs/s1600/lapply_ftype.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1018" data-original-width="816" height="400" src="https://4.bp.blogspot.com/-0SfuXUnNzQc/WXjDxPfhTpI/AAAAAAAALws/IAMSNAo8178dtDF4OWLd2zPkO52S3POkQCLcBGAs/s400/lapply_ftype.png" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-ueLGXKOGUjE/WXjD6WnCk6I/AAAAAAAALww/_6cUqiMAMEYUaPxOfb55PcSf1sxX1lWRACLcBGAs/s1600/lapply.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="731" data-original-width="1600" height="182" src="https://1.bp.blogspot.com/-ueLGXKOGUjE/WXjD6WnCk6I/AAAAAAAALww/_6cUqiMAMEYUaPxOfb55PcSf1sxX1lWRACLcBGAs/s400/lapply.png" width="400" /></a></div><br /><br />#5<br />使用&nbsp;methods 函數與 getAnywhere 函數.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-xwPAJopoFOo/WXjE9DSHR6I/AAAAAAAALw4/U8ZElWjsYoY1-sfe0qpEyyzf-QmA6Zg7gCLcBGAs/s1600/princomp.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1058" data-original-width="1338" height="316" src="https://2.bp.blogspot.com/-xwPAJopoFOo/WXjE9DSHR6I/AAAAAAAALw4/U8ZElWjsYoY1-sfe0qpEyyzf-QmA6Zg7gCLcBGAs/s400/princomp.png" width="400" /></a></div><br /><h2>R程式碼</h2><br /><pre><code class="language-r line-numbers">library(pryr)<br />ftype(apply) # "function"<br />apply<br /><br />lapply<br />ftype(lapply) # "internal"<br />getAnywhere(lapply)<br />show_c_source(.Primitive(lapply(x)))<br /><br />princomp<br />ftype(princomp) # "s3" "generic"<br />methods(princomp)<br />getAnywhere(princomp.default)<br /># end</code></pre><br /><h2>參考資料</h2>[1]&nbsp;<a href="https://stackoverflow.com/questions/19226816/how-can-i-view-the-source-code-for-a-function" target="_blank">https://stackoverflow.com/questions/19226816/how-can-i-view-the-source-code-for-a-function</a><br /><br />[2]&nbsp;<a href="https://stackoverflow.com/questions/3485228/view-source-code-in-r" target="_blank">https://stackoverflow.com/questions/3485228/view-source-code-in-r</a><br /><br />[3] R Core Team, R Internals - Version 3.4.1 (2017-06-30), URL: &nbsp;<a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.pdf" target="_blank">https://cran.r-project.org/doc/manuals/r-release/R-ints.pdf</a>.<br /><br />[4] R 原始碼, <a href="https://cran.r-project.org/src/base/R-3/R-3.4.1.tar.gz" target="_blank">https://cran.r-project.org/src/base/R-3/R-3.4.1.tar.gz</a>
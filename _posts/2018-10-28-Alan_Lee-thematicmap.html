---
author: "Alan Lee"
title: "主題式地圖(Thematic map) - 政府開放資料為例"
tags: ['graphics', 'legend', 'packages', 'plot', 'tutorials', 'visualization']
link: "http://rwepa.blogspot.com/2018/10/thematicmap.html"
highlight: true
---

<div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-DQ7XNRqyHs8/W9UymbrAxKI/AAAAAAAAUUw/gdIz_bYyK_0dp6_f6AR2nGfc3aE5NQFFgCLcBGAs/s1600/thematicplot.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1200" data-original-width="1600" height="240" src="https://2.bp.blogspot.com/-DQ7XNRqyHs8/W9UymbrAxKI/AAAAAAAAUUw/gdIz_bYyK_0dp6_f6AR2nGfc3aE5NQFFgCLcBGAs/s320/thematicplot.gif" width="320" /></a></div><br />#&nbsp;主題式地圖<br />#&nbsp;Thematic map<br />#&nbsp;開放式資料<br /># open data<br /># 地圖資料與社會經濟資料合併<br />#&nbsp;rgdal 套件<br />#&nbsp;tmap 套件<br /><br />本例說明考量社會經濟等開放式資料，輔以主題式繪圖方式，提升資料視覺化品質，便於資料呈現與溝通。<!--more-->下載資料的儲存目錄以C:\rdata為主。本範例包括以下六大步驟：<br /><br />步驟1：下載社會經濟開放資料<br />步驟2：下載地圖資料<br />步驟3：匯入地圖資料至R<br />步驟4：匯入臺北市住宅竊盜點位資訊資料<br />步驟5：將臺北市住宅竊盜點位資訊整合至twn.taipei@data<br />步驟6：臺北市住宅竊盜分佈圖<br /><h2><span style="color: #3d85c6; font-size: large;">步驟1：下載社會經濟開放資料</span></h2>本例以臺北市住宅竊盜點位資訊為例，資料筆數；1945，欄位個數：5，欄位名稱：編號，案類，發生(現)日期，發生時段，發生(現)地點。下載檔案：「臺北市10401-10709住宅竊盜點位資訊.csv」 。<br /><br />下載網址：<a href="https://data.gov.tw/dataset/73886" target="_blank">https://data.gov.tw/dataset/73886</a>，參考圖-1，圖-2說明。<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-xEDkjfbqI4o/W9CHmHHYjsI/AAAAAAAAUOQ/36CbTdrvuR8IccPZ3goon5Lcyiy71aTVACLcBGAs/s1600/%25E8%2587%25BA%25E5%258C%2597%25E5%25B8%2582%25E4%25BD%258F%25E5%25AE%2585%25E7%25AB%258A%25E7%259B%259C%25E9%25BB%259E%25E4%25BD%258D%25E8%25B3%2587%25E8%25A8%258A.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="776" data-original-width="1168" height="265" src="https://2.bp.blogspot.com/-xEDkjfbqI4o/W9CHmHHYjsI/AAAAAAAAUOQ/36CbTdrvuR8IccPZ3goon5Lcyiy71aTVACLcBGAs/s400/%25E8%2587%25BA%25E5%258C%2597%25E5%25B8%2582%25E4%25BD%258F%25E5%25AE%2585%25E7%25AB%258A%25E7%259B%259C%25E9%25BB%259E%25E4%25BD%258D%25E8%25B3%2587%25E8%25A8%258A.png" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />圖1-開放資料-臺北市住宅竊盜點位資訊<br /><br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-uOz4qD5lqOk/W9F12ecwSuI/AAAAAAAAUOg/DkrxQXvxLXo191AHa5gYRLLu9vAdQzZhACLcBGAs/s1600/%25E8%2587%25BA%25E5%258C%2597%25E5%25B8%2582%25E4%25BD%258F%25E5%25AE%2585%25E7%25AB%258A%25E7%259B%259C%25E9%25BB%259E%25E4%25BD%258D%25E8%25B3%2587%25E8%25A8%258A.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="273" data-original-width="687" height="158" src="https://3.bp.blogspot.com/-uOz4qD5lqOk/W9F12ecwSuI/AAAAAAAAUOg/DkrxQXvxLXo191AHa5gYRLLu9vAdQzZhACLcBGAs/s400/%25E8%2587%25BA%25E5%258C%2597%25E5%25B8%2582%25E4%25BD%258F%25E5%25AE%2585%25E7%25AB%258A%25E7%259B%259C%25E9%25BB%259E%25E4%25BD%258D%25E8%25B3%2587%25E8%25A8%258A.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;">圖2-臺北市住宅竊盜點位資訊CSV檔案</div><h2 style="clear: both; text-align: left;"><span style="color: #3d85c6; font-size: large;">步驟2：下載地圖資料</span></h2><div class="separator" style="clear: both; text-align: left;">參考政府資料開放平台，常用的地理資料包括下列二個項目：</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both;">1. 鄉鎮市區界線(TWD97經緯度)，資料包括鄉(鎮、市、區)行政區域界線圖資。</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">下載網址：<a href="https://data.gov.tw/dataset/7441" target="_blank">https://data.gov.tw/dataset/7441</a>，參考圖-3說明。</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-7i_K8khlTX0/W9RwVopaosI/AAAAAAAAUUM/9hiYEKDLQ2gvHXlIj-RXr-4HHFz--dGcQCLcBGAs/s1600/%25E5%259C%25963-%25E9%2584%2589%25E9%258E%25AE%25E5%25B8%2582%25E5%258D%2580%25E7%2595%258C%25E7%25B7%259A%25E4%25B8%258B%25E8%25BC%2589.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="662" data-original-width="1382" height="190" src="https://4.bp.blogspot.com/-7i_K8khlTX0/W9RwVopaosI/AAAAAAAAUUM/9hiYEKDLQ2gvHXlIj-RXr-4HHFz--dGcQCLcBGAs/s400/%25E5%259C%25963-%25E9%2584%2589%25E9%258E%25AE%25E5%25B8%2582%25E5%258D%2580%25E7%2595%258C%25E7%25B7%259A%25E4%25B8%258B%25E8%25BC%2589.png" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: left;">圖3-鄉鎮市區界線下載</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">2. 直轄市、縣市界線(TWD97經緯度)，資料包括直轄市以及縣(市)行政區域界線圖資</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">下載網址：<a href="https://data.gov.tw/dataset/7442" target="_blank">https://data.gov.tw/dataset/7442</a>，參考圖-4說明。</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/--B-ry4_WsGg/W9RwXNTlViI/AAAAAAAAUUQ/ZqGgD6aN2ek_rN5J9oPi9_DvMVVLUwB6gCLcBGAs/s1600/%25E5%259C%25964-%25E7%259B%25B4%25E8%25BD%2584%25E5%25B8%2582%25E3%2580%2581%25E7%25B8%25A3%25E5%25B8%2582%25E7%2595%258C%25E7%25B7%259A%25E4%25B8%258B%25E8%25BC%2589.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img alt="" border="0" data-original-height="663" data-original-width="993" height="265" src="https://2.bp.blogspot.com/--B-ry4_WsGg/W9RwXNTlViI/AAAAAAAAUUQ/ZqGgD6aN2ek_rN5J9oPi9_DvMVVLUwB6gCLcBGAs/s400/%25E5%259C%25964-%25E7%259B%25B4%25E8%25BD%2584%25E5%25B8%2582%25E3%2580%2581%25E7%25B8%25A3%25E5%25B8%2582%25E7%2595%258C%25E7%25B7%259A%25E4%25B8%258B%25E8%25BC%2589.png" title="圖4-直轄市、縣市界線下載" width="400" /></a></div><div class="separator" style="clear: both;">圖4-直轄市、縣市界線下載</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">本例考量分析台北市各區資料，因此下載第一項「 鄉鎮市區界線(TWD97經緯度)」，下載檔案為「&nbsp;mapdata201805311056.zip」，解壓縮為「C:\rdata\mapdata201805311056」資料夾，參考圖-5說明。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both;">地圖資料包括 .shp, .shx, .dbf, .prj，其中shp, shx, dbf 為三個必備檔案：</div><div class="separator" style="clear: both;"></div><ul><li>.shp：圖形格式，用於儲存地圖元素的幾何資料。</li><li>.shx：— 圖形索引格式，即幾何資料索引。記錄每一個幾何資料shp檔案之中的位置，能夠加快向前或向後搜尋幾何資料的效率。</li><li>.dbf：屬性資料格式，以dBase IV的資料表格式儲存每個幾何形狀的屬性資料。</li><li>.prj：圖形格式.shp檔案中幾何資料所使用的經緯度座標系統。</li></ul><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-u9XcnFHvMXw/W9R4eRpKQwI/AAAAAAAAUUg/NleFnB3Icsw-c_ezy6ezWaB8PjLXdw96QCLcBGAs/s1600/%25E5%259C%25965-%25E9%2584%2589%25E9%258E%25AE%25E5%25B8%2582%25E5%258D%2580%25E7%2595%258C%25E7%25B7%259A%2528TWD97%25E7%25B6%2593%25E7%25B7%25AF%25E5%25BA%25A6%2529%25E8%25A7%25A3%25E5%25A3%2593%25E8%25B3%2587%25E6%2596%2599%25E5%25A4%25BE.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="292" data-original-width="688" height="168" src="https://1.bp.blogspot.com/-u9XcnFHvMXw/W9R4eRpKQwI/AAAAAAAAUUg/NleFnB3Icsw-c_ezy6ezWaB8PjLXdw96QCLcBGAs/s400/%25E5%259C%25965-%25E9%2584%2589%25E9%258E%25AE%25E5%25B8%2582%25E5%258D%2580%25E7%2595%258C%25E7%25B7%259A%2528TWD97%25E7%25B6%2593%25E7%25B7%25AF%25E5%25BA%25A6%2529%25E8%25A7%25A3%25E5%25A3%2593%25E8%25B3%2587%25E6%2596%2599%25E5%25A4%25BE.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">圖5-鄉鎮市區界線(TWD97經緯度)解壓資料夾</div><h2 style="clear: both;"><span style="color: #3d85c6; font-size: large;">步驟3：匯入地圖資料至R</span></h2><div class="separator" style="clear: both; text-align: left;">使用 rgdal 套件的 readOGR函數 以匯入地圖資料，使用 tmap 套件以製作主題式地圖</div><br />library(rgdal)<br />library(tmap)<br /><br /># 匯入地理資料 readOGR {rgdal}<br />twn &lt;- readOGR(dsn="C:/rdata/mapdata201805311056", layer="TOWN_MOI_1070516", encoding="UTF-8")<br />head(twn@data) # 中文亂碼<br /><br /># 中文亂碼轉換 iconv {base}<br />twn@data$COUNTYNAME &lt;- iconv(twn@data$COUNTYNAME, from = "UTF-8", to="UTF-8")<br />twn@data$TOWNNAME &lt;- iconv(twn@data$TOWNNAME, from = "UTF-8", to="UTF-8")<br />head(twn@data) # 中文正常顯示<br /><br />names(attributes(twn)) # 7個屬性<br />summary(twn) # 資料摘要<br />names(twn) # 7個欄位<br />class(twn) # SpatialPolygonsDataFrame<br />str(twn@data) # 368*7<br /><br /># 篩選臺北市地理資料<br />twn.taipei &lt;- twn[which(twn@data$COUNTYNAME == "臺北市"), ]<br />twn.taipei@data<br /><br />str(twn.taipei@polygons[1])<br />str(twn.taipei@polygons[5])<br /><h2><span style="color: #3d85c6; font-size: large;"><b>步驟4：匯入臺北市住宅竊盜點位資訊資料</b></span></h2>theft &lt;- read.table("臺北市10401-10709住宅竊盜點位資訊.csv", header=TRUE, sep=",", stringsAsFactors=FALSE) # 2054*5<br /><br /># 將發生.現.日期由民國年轉為西元年<br />theft$發生.現.日期 &lt;- as.Date(unlist(lapply(theft$發生.現.日期, function(x) {<br />&nbsp; if (nchar(x) == 6) return(paste0(as.numeric(substr(x,1,2))+1911, "-", substr(x,3,4), "-", substr(x,5,6)))<br />&nbsp; if (nchar(x) == 7) return(paste0(as.numeric(substr(x,1,3))+1911, "-", substr(x,4,5), "-", substr(x,6,7)))<br />})))<br /><br /># 新增行政區欄位<br /># substr 函數與 Excel =MID函數 類似, 取出部分字串<br />theft$行政區 &lt;- substr(theft$發生.現.地點,4,6)<br /><br /># 篩選2018年&amp;台北市資料<br />theft.2018 &lt;- theft[theft$發生.現.日期 &gt;= as.Date("2018-01-01") &amp;&nbsp; substr(theft$發生.現.地點,1,3) == "台北市" ,] # 247*6<br /><br /># 樞紐分析各行政區住宅竊盜次數小計<br />theaft.area &lt;- aggregate(案類~行政區, data=theft.2018[c(2,6)], length)<br />names(theaft.area) &lt;- c("行政區", "住宅竊盜發生數")<br />summary(theaft.area)<br /><br /><h2><b><span style="color: #3d85c6; font-size: large;">步驟5：將臺北市住宅竊盜點位資訊整合至twn.taipei@data</span></b></h2># merge函數中,sort參數須設定為FALSE,否則繪圖位置會有錯誤<br />twn.taipei@data &lt;- merge(twn.taipei@data, theaft.area, by.x = "TOWNNAME", by.y = "行政區", <span style="color: red;">sort=FALSE</span>)<br />twn.taipei@data<br /><h2><span style="color: #3d85c6; font-size: large;"><b>步驟6：臺北市住宅竊盜分佈圖</b></span></h2># method 1 採用 plot{graphics}<br />住宅竊盜發生數.color &lt;- cut(twn.taipei@data$住宅竊盜發生數,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;breaks=c(0,10,15,20,30,Inf),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;labels=c("10以下", "11~15", "16~20", "21~30", "31以上"))<br /><br /># 建立彩色調色盤(color palette)<br /># 內建調色盤 rainbow, heat.colors, terrain.colors, topo.colors, cm.colors, 本例以heat.colors為主<br />twn.taipei@data$Col &lt;- heat.colors(5)[as.numeric(住宅竊盜發生數.color)]<br /><br />plot(twn.taipei, col=twn.taipei@data$Col, main="2018年臺北市住宅竊盜分佈圖")<br />text(coordinates(twn.taipei)[,1], coordinates(twn.taipei)[,2], twn.taipei$TOWNNAME, cex=0.7)<br />legend("topright", legend=levels(住宅竊盜發生數.color), fill=twn.taipei@data$Col, col= heat.colors(5), title="住宅竊盜發生數")<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-aScM6OiA6wM/W9UzVuROMTI/AAAAAAAAUU4/jX896U9DksEYot-LqyxS5HS2ErZvY3PEwCLcBGAs/s1600/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25961.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1200" data-original-width="1600" height="240" src="https://4.bp.blogspot.com/-aScM6OiA6wM/W9UzVuROMTI/AAAAAAAAUU4/jX896U9DksEYot-LqyxS5HS2ErZvY3PEwCLcBGAs/s320/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25961.png" width="320" /></a></div><br /># method 2 採用 qtm{tmap}<br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖")<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-Af-4Sey29ug/W9Uzd_p4ddI/AAAAAAAAUU8/2bwwBJDhMhY8sC8VENmuOZqsiNIHoyYmgCLcBGAs/s1600/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25962.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1200" data-original-width="1600" height="240" src="https://2.bp.blogspot.com/-Af-4Sey29ug/W9Uzd_p4ddI/AAAAAAAAUU8/2bwwBJDhMhY8sC8VENmuOZqsiNIHoyYmgCLcBGAs/s320/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25962.png" width="320" /></a></div><br /><br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖", fill.palette="Blues")<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-uE1R78i1htA/W9Uzk_W1rfI/AAAAAAAAUVA/C4TlONqWb0EzFmi8Bwbz5PXQZUqB40fXwCLcBGAs/s1600/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25963.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1200" data-original-width="1600" height="240" src="https://1.bp.blogspot.com/-uE1R78i1htA/W9Uzk_W1rfI/AAAAAAAAUVA/C4TlONqWb0EzFmi8Bwbz5PXQZUqB40fXwCLcBGAs/s320/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25963.png" width="320" /></a></div><br /><br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖", fill.palette="Greens")<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-Lqrr0gcgPt8/W9UzvLnPIoI/AAAAAAAAUVM/Xpka3qsOUyIv_TAnjzsY0V8izgkl9xbOgCLcBGAs/s1600/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25964.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1200" data-original-width="1600" height="240" src="https://1.bp.blogspot.com/-Lqrr0gcgPt8/W9UzvLnPIoI/AAAAAAAAUVM/Xpka3qsOUyIv_TAnjzsY0V8izgkl9xbOgCLcBGAs/s320/%25E4%25B8%25BB%25E9%25A1%258C%25E7%25B9%25AA%25E5%259C%25964.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">R程式碼 :</div><div><pre><code class="language-r line-numbers"># title: 主題式地圖(Thematic map)-以政府開放資料為例<br /># date: 2018.10.28<br /># 本例說明考量社會經濟等開放式資料，輔以主題式繪圖方式，提升資料視覺化品質，使於資料呈現與溝通。<br /><br /># 步驟1：<br /># 下載社會經濟等開放式資料，本例以臺北市住宅竊盜點位資訊為例，資料筆數；1945，欄位個數：5，欄位名稱：編號，案類，發生(現)日期，發生時段，發生(現)地點。<br /># 下載網址：https://data.gov.tw/dataset/73886<br /><br /># 步驟2：下載地圖資料<br /># 本例考量分析台北市各區資料，因此下載第一項「 鄉鎮市區界線(TWD97經緯度)」，下載檔案為「 mapdata201805311056.zip」，解壓縮為「C:\rdata\mapdata201805311056」資料夾<br /><br /># 下載世界地圖<br /># http://www.diva-gis.org/gdata<br /><br /><br /># 步驟3：匯入地圖資料至R<br /># 使用 rgdal 套件的 readOGR函數 以匯入地圖資料，使用 tmap 套件以製作主題式地圖<br /><br />library(rgdal)<br />library(tmap)<br /><br /># 匯入地理資料<br />twn &lt;- readOGR(dsn="C:/rdata/mapdata201805311056", layer="TOWN_MOI_1070516", encoding="UTF-8")<br />head(twn@data) # 中文亂碼<br /><br /># twn &lt;- readOGR(dsn="C:/rdata/TWN_adm", layer="TWN_adm1", encoding="UTF-8")<br />head(twn@data) # 中文亂碼<br />names(twn@data)<br /><br /># 中文亂碼轉換 iconv<br />twn@data$COUNTYNAME &lt;- iconv(twn@data$COUNTYNAME, from = "UTF-8", to="UTF-8")<br />twn@data$TOWNNAME &lt;- iconv(twn@data$TOWNNAME, from = "UTF-8", to="UTF-8")<br />head(twn@data) # 中文正常顯示<br /><br />names(attributes(twn)) # 7個屬性<br />summary(twn) # 資料摘要<br />names(twn) # 7個欄位<br />class(twn) # SpatialPolygonsDataFrame<br />str(twn@data) # 368*7<br /><br /># 篩選臺北市地理資料<br />twn.taipei &lt;- twn[which(twn@data$COUNTYNAME == "臺北市"), ]<br />twn.taipei@data<br /><br />str(twn.taipei@polygons[1])<br />str(twn.taipei@polygons[5])<br /><br /># 步驟4：匯入臺北市住宅竊盜點位資訊資料<br />theft &lt;- read.table("臺北市10401-10709住宅竊盜點位資訊.csv", header=TRUE, sep=",", stringsAsFactors=FALSE) # 2054*5<br /><br /># 將發生.現.日期由民國年轉為西元年<br />theft$發生.現.日期 &lt;- as.Date(unlist(lapply(theft$發生.現.日期, function(x) {<br /> if (nchar(x) == 6) return(paste0(as.numeric(substr(x,1,2))+1911, "-", substr(x,3,4), "-", substr(x,5,6)))<br /> if (nchar(x) == 7) return(paste0(as.numeric(substr(x,1,3))+1911, "-", substr(x,4,5), "-", substr(x,6,7)))<br />})))<br /><br /># 新增行政區欄位<br />theft$行政區 &lt;- substr(theft$發生.現.地點,4,6)<br /><br /># 篩選2018年&amp;台北市資料<br />theft.2018 &lt;- theft[theft$發生.現.日期 &gt;= as.Date("2018-01-01") &amp; substr(theft$發生.現.地點,1,3) == "台北市" ,] # 247*6<br /><br /># 樞紐分析各行政區住宅竊盜次數小計<br />theaft.area &lt;- aggregate(案類~行政區, data=theft.2018[c(2,6)], length)<br />names(theaft.area) &lt;- c("行政區", "住宅竊盜發生數")<br />summary(theaft.area)<br /><br /># 步驟5：將臺北市住宅竊盜點位資訊資料整合至 twn.taipei@data<br /># merge函數中,sort參數須設定為FALSE,否則繪圖位置會有錯誤<br />twn.taipei@data &lt;- merge(twn.taipei@data, theaft.area, by.x = "TOWNNAME", by.y = "行政區", sort=FALSE)<br />twn.taipei@data<br /><br /># 步驟6：臺北市住宅竊盜分佈圖<br /><br /># method 1 採用 plot{graphics}<br />住宅竊盜發生數.color &lt;- cut(twn.taipei@data$住宅竊盜發生數, <br /> breaks=c(0,10,15,20,30,Inf), <br /> labels=c("10以下", "11~15", "16~20", "21~30", "31以上"))<br /><br /># 建立彩色調色盤(color palette)<br /># 內建調色盤 rainbow, heat.colors, terrain.colors, topo.colors, cm.colors, 本例以heat.colors為主<br />twn.taipei@data$Col &lt;- heat.colors(5)[as.numeric(住宅竊盜發生數.color)]<br /><br />plot(twn.taipei, col=twn.taipei@data$Col, main="2018年臺北市住宅竊盜分佈圖")<br />text(coordinates(twn.taipei)[,1], coordinates(twn.taipei)[,2], twn.taipei$TOWNNAME, cex=0.7)<br />legend("topright", legend=levels(住宅竊盜發生數.color), fill=twn.taipei@data$Col, col= heat.colors(5), title="住宅竊盜發生數")<br /><br /># method 2 採用 qtm{tmap}<br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖")<br /><br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖", fill.palette="Blues")<br /><br />qtm(shp=twn.taipei, fill="住宅竊盜發生數", text="TOWNNAME", fill.title="住宅竊盜發生數", title="2018年臺北市住宅竊盜分佈圖", fill.palette="Greens")<br /># end</code></pre></div>
---
author: "Alan Lee"
title: "Tableau 與 R 整合"
tags: ['Rserve', 'tableau', 'visualization']
link: "http://rwepa.blogspot.com/2019/03/tableau-r.html"
highlight: true
---

本篇文章說明如何在 Tableau 軟體中使用 R 語言建立模型,以提供決策支援.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-BlQzEg5pkWc/XJtguaaAyvI/AAAAAAAAWN4/z9wZxhB8mLARtmHpcJyzAMq3fs7gK0MCgCLcBGAs/s1600/8.iris_final.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="850" data-original-width="1600" height="170" src="https://3.bp.blogspot.com/-BlQzEg5pkWc/XJtguaaAyvI/AAAAAAAAWN4/z9wZxhB8mLARtmHpcJyzAMq3fs7gK0MCgCLcBGAs/s320/8.iris_final.png" width="320" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /># Tableau<br /># R<br /># Rserve 套件<br /># Clustering<br /># kmeans<br /><br />參考資料:<br /><a href="https://github.com/rwepa/tableaur" target="_blank">https://github.com/rwepa/tableaur</a><br /><br /><br />1. 下載並安裝 Tableau 14天版本<br /><a href="https://www.tableau.com/products/trial" target="_blank">https://www.tableau.com/products/trial</a><br /><br />2. 下載並安裝&nbsp;R語言/RStudio軟體<br /><a href="https://www.r-project.org/" target="_blank">https://www.r-project.org/</a><br /><a href="https://www.rstudio.com/products/rstudio/download/#download" target="_blank">https://www.rstudio.com/products/rstudio/download/#download</a><br /><br />3. 安裝 Rserve 套件, 安裝套件僅需安裝一次即可.<br /><span style="background-color: #eeeeee;">install.packages("Rserve")</span><br /><br />4. 載入 Rserve 套件<br /><span style="background-color: #eeeeee;">library(Rserve)</span><br /><br />5. 啟動 Rserve 套件<br /><span style="background-color: #eeeeee;">Rserve()</span><br /><br />參考下圖安裝與執行結果. 每次使用皆須完成此設定.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-xMO295WxxXM/XJrn-JDU5WI/AAAAAAAAWMo/APA-NL6hIrMnFMF3sIZPw9U0T6gQvEVrACLcBGAs/s1600/0.rserveinstall.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="739" data-original-width="899" height="328" src="https://4.bp.blogspot.com/-xMO295WxxXM/XJrn-JDU5WI/AAAAAAAAWMo/APA-NL6hIrMnFMF3sIZPw9U0T6gQvEVrACLcBGAs/s400/0.rserveinstall.png" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />6. 設定 Tableau 與 R 連結<br />Tableau \ Help \ Settings and Performance \ Manage External Service Connection<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-wMRpKG-6Uok/XJroRBuLuuI/AAAAAAAAWMw/sq7_mCCV660BhkQ4R9BLDqGDspob8s8XACLcBGAs/s1600/1.tableauandR.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="572" data-original-width="870" height="262" src="https://4.bp.blogspot.com/-wMRpKG-6Uok/XJroRBuLuuI/AAAAAAAAWMw/sq7_mCCV660BhkQ4R9BLDqGDspob8s8XACLcBGAs/s400/1.tableauandR.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">7. External Service Connection 視窗 \ Server 選項點選 localhost \ 按 Test Connection.</div><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-0qILfL1hEr4/XJroTLeXOLI/AAAAAAAAWM0/gKC7D0TCipQP1DCgg7r1qP7paPdlXfxHACLcBGAs/s1600/2.server.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="453" data-original-width="436" height="320" src="https://2.bp.blogspot.com/-0qILfL1hEr4/XJroTLeXOLI/AAAAAAAAWM0/gKC7D0TCipQP1DCgg7r1qP7paPdlXfxHACLcBGAs/s320/2.server.png" width="307" /></a></div><br />8. Tableau 視窗會顯示 Successfully connected to the external service. 表示Tableau 與 R 連接成功. 注意: 每次啟動Tableau 連結 R 皆須進行設定.<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/--bcR6hrmlDM/XJrpHFPi7BI/AAAAAAAAWNA/QLnbDuMlbvQZEBGVqKC7xd1aST8vE1v5gCLcBGAs/s1600/3.connect.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="182" data-original-width="548" height="132" src="https://3.bp.blogspot.com/--bcR6hrmlDM/XJrpHFPi7BI/AAAAAAAAWNA/QLnbDuMlbvQZEBGVqKC7xd1aST8vE1v5gCLcBGAs/s400/3.connect.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">9. 將 iris 資料集匯出成 iris.csv 以提供 Tableau 匯入資料.</div><div class="separator" style="clear: both; text-align: left;">RStudio輸入&nbsp;<span style="background-color: #eeeeee;">write.table(iris, file="iris.csv", sep=",", row.names=FALSE)</span></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">10. Tableau 匯入 iris.csv.</div><div class="separator" style="clear: both; text-align: left;">Tableau \ Connect \ Text file \ iris.csv \ 開啟</div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/--np9m2szYQw/XJrwiJtY4nI/AAAAAAAAWNM/rcsDfqMPb8UoR_plL5WaA923QGRNWGAHwCLcBGAs/s1600/4.tableau_iris.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="573" data-original-width="1150" height="198" src="https://4.bp.blogspot.com/--np9m2szYQw/XJrwiJtY4nI/AAAAAAAAWNM/rcsDfqMPb8UoR_plL5WaA923QGRNWGAHwCLcBGAs/s400/4.tableau_iris.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">11. 選取 Sheet1 \ Measures 空白處 \ 右鍵 \ Create Calculated Field</div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-RYJrRW7-6No/XJrxcID1WtI/AAAAAAAAWNU/Q0W9wq1GRvYISC-2xiTGuG-QOWsM3IZUACLcBGAs/s1600/5.CreateCalculatedField.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="312" data-original-width="596" height="208" src="https://1.bp.blogspot.com/-RYJrRW7-6No/XJrxcID1WtI/AAAAAAAAWNU/Q0W9wq1GRvYISC-2xiTGuG-QOWsM3IZUACLcBGAs/s400/5.CreateCalculatedField.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">12. Create Calculated Field 視窗 \ 名稱改為 集群 新增以下內容</div><div class="separator" style="clear: both;">SCRIPT_INT(<span style="background-color: yellow;">'set.seed(168);</span></div><div class="separator" style="clear: both;"><span style="background-color: yellow;">result &lt;- kmeans(data.frame(.arg1,.arg2,.arg3,.arg4), 3);</span></div><div class="separator" style="clear: both;"><span style="background-color: yellow;">result$cluster;'</span>,&nbsp;</div><div class="separator" style="clear: both;"><span style="background-color: #cfe2f3;">SUM([Sepal.Length]),SUM([Sepal.Width]),SUM([Petal.Length]),SUM([Petal.Width])</span>)</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"></div><ol><li>本例使用集群 kmeans 演算法. result為kmeans 演算法的計算結果. result$cluster 回傳是集群整數編號, 因此使用 SCRIPT_INT 整數 Tableau 函數.</li><li>黃色 R 程式以 ' ' 標註, 三行R程式以 ; 區隔.</li><li>四個欄位名稱以SUM函數表示, 中間以 , 區隔.</li></ol><div class="separator" style="clear: both; text-align: left;"></div><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-UuvgNAAEf0Y/XJsnY3wW9LI/AAAAAAAAWNk/k-kTAK0Hv5Mlwrc5-TACWljNyxFoYtmGgCEwYBhgL/s1600/7.Create%2BCalculated%2BField.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="374" data-original-width="1079" height="137" src="https://3.bp.blogspot.com/-UuvgNAAEf0Y/XJsnY3wW9LI/AAAAAAAAWNk/k-kTAK0Hv5Mlwrc5-TACWljNyxFoYtmGgCEwYBhgL/s400/7.Create%2BCalculated%2BField.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">13. 選取 集群 \ 右鍵 \&nbsp;Convert to Discrete 將資料轉換為離散型變數.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">14. 建立視覺化集群結果.</div><div class="separator" style="clear: both; text-align: left;"></div><ol><li>將 Petal.Length 拖曳至 Columns</li><li>將 Petal.Width 拖曳至 Rows</li><li>將 集群 拖曳至 Color</li></ol><br /><div class="separator" style="clear: both; text-align: left;"># end</div>
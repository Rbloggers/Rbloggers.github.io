---
author: "Alan Lee"
title: "r quantmod 套件下載財金資料與錯誤解決方法-Errors Downloading Stock Price Data from Yahoo Finance"
tags: ['finance', 'packages', 'quantmod']
link: "http://rwepa.blogspot.com/2017/06/r-quantmod-errors-downloading-stock.html"
highlight: true
---

本篇文章說明&nbsp;quantmod 套件的使用方法與遭遇錯誤 "Errors Downloading Stock Price Data from Yahoo Finance" 的解決方法.<br /><br /><h2>安裝&nbsp;quantmod 套件</h2>install.packages("quantmod")<br />library(quantmod)<br /><br /><h2>下載財金資料 - Input</h2>使用&nbsp;getSymbols 函數以下載財金資料, 該函數預設的資料來源是 yahoo finance, 使用 from 參數可設定開始日期, 同理to參數可設定結束日期, 本例使from參數<br /><br />getSymbols("IBM", from="2010-1-1")<br /><br /><h2>理解財金資料 - Process</h2><br /><ul><li>使用 class 函數可知回傳物件是xts物件與zoo物件, 其中 xts 物件延伸來自於 zoo物件(注意: zoo不是動物園物件 ^_^).&nbsp;</li><li>使用 str 函數, 可知資料有1877列, 6欄資料.&nbsp;</li><li>summary函數結果顯示 Index 屬性 為年月日資料</li><li>head 結果是從2010年1月4日開始, tail 結果表示資料至2017年6月16日結束.</li><li>使用?periodReturn 可查詢計算報酬率的使用, 包括週,日,月,季的報酬率.</li></ul><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-sH3k_smvLvk/WUfbkTrQA3I/AAAAAAAALpI/lJ6xD5NvLp07H5eEc58cWIiklYXwSJpiACLcBGAs/s1600/quantmod_str.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" data-original-height="1450" data-original-width="1423" height="400" src="https://1.bp.blogspot.com/-sH3k_smvLvk/WUfbkTrQA3I/AAAAAAAALpI/lJ6xD5NvLp07H5eEc58cWIiklYXwSJpiACLcBGAs/s400/quantmod_str.png" width="392" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><h2>繪製結果 - Output</h2><ul><li>plot 函數即可繪製資料圖形, 預設是以 Close 欄位為主</li><li>plot(IBM, major.ticks='years') , major.ticks 參數可顯示主要縱軸刻度位置, 本例為年, 此時圖形會較簡潔.</li><li>chartSeries(IBM) 提供收盤價(Close)與成交量(Volume)股票圖.</li></ul><h2>台股範例</h2><div>台股使用的符號是 ^TWII, 如果有 NA, 可配合na.omit 將該NA資料刪除.</div><div>getSymbols("^TWII", from="2010-1-1")&nbsp;</div><div><br /></div><h2>程式碼</h2><div><pre><code class="language-r line-numbers"># 安裝 quantmod 套件<br />install.packages("quantmod")<br />library(quantmod)<br /><br /># 下載財金資料<br />getSymbols("IBM", from="2010-1-1")<br /><br /># 理解財金資料<br />class(IBM)<br />str(IBM)<br />summary(IBM)<br /><br />head(IBM)<br />tail(IBM)<br /><br /># ?periodReturn<br />allReturns(IBM)<br />periodReturn(IBM, period='monthly',subset='2013::')  # 回傳自2013年至目前報酬率<br />periodReturn(IBM, period='yearly',subset='2013')     # 回自2013年報酬率<br />monthlyReturn(IBM, subset='2013::')<br />yearlyReturn(IBM, subset='2013::')<br /><br /># 繪製結果<br />plot(IBM)<br />plot(IBM, major.ticks='years')<br />chartSeries(IBM)<br /><br /># 台股範例,讀取資料-台灣加權指數 TWII (TSEC weighted index)<br />getSymbols("^TWII", from="2010-1-1")<br />dim(TWII)<br />summary(TWII)<br />chartSeries(TWII)</code></pre><br /></div><div><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-PHQ0RsaE6eU/WUfk35lj9vI/AAAAAAAALpg/u-YiATHuDr0Qjg8mJzI1KC29e7YFHl5VwCEwYBhgL/s1600/twii.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="600" data-original-width="800" height="300" src="https://2.bp.blogspot.com/-PHQ0RsaE6eU/WUfk35lj9vI/AAAAAAAALpg/u-YiATHuDr0Qjg8mJzI1KC29e7YFHl5VwCEwYBhgL/s400/twii.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><h2><span style="color: red;">!!!Errors Downloading Stock Price Data from Yahoo Finance</span></h2><br />在使用 quantmod 套件時, 如果資料下載顯示有錯誤, 參考以下步驟設定, 如果一般安裝與下載皆正常, 則不用使用此方法.<br /><br />步驟1: 下載 Rtools 程式, 本程式具有建立套件等輔助工具<br />連結&nbsp;<a href="http://cran.csie.ntu.edu.tw/bin/windows/Rtools/" target="_blank">http://cran.csie.ntu.edu.tw/bin/windows/Rtools/</a>&nbsp;, 選取&nbsp;Rtools Downloads 下載.<br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-ds-r2lsjbHg/WUfmnHWgFJI/AAAAAAAALpo/rbI_MymvBNM_Ky-NuWgBePLRVOxr-ZI5gCLcBGAs/s1600/Rtools%2BDownloads.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="714" data-original-width="1288" height="221" src="https://1.bp.blogspot.com/-ds-r2lsjbHg/WUfmnHWgFJI/AAAAAAAALpo/rbI_MymvBNM_Ky-NuWgBePLRVOxr-ZI5gCLcBGAs/s400/Rtools%2BDownloads.png" width="400" /></a></div><br />步驟2: 安裝 Rtools 程式, 使用預設安裝選項,不可更改安裝路徑, 安裝完成後的目錄為 C:\Rtools<br /><br />步驟3: 在 RStudio 程式中安裝 devtools 套件, 輸入 install.packages("devtools")<br /><br />步驟4: 在 RStudio 程式中輸入以下R程式即可完成 quantmod 安裝.<br /><br /><pre><code class="language-r">devtools::install_github("joshuaulrich/quantmod", ref="157_yahoo_502")<br /></code></pre><br /># 參考:&nbsp;<a href="https://robotwealth.com/solved-errors-downloading-stock-price-data-yahoo-finance/" target="_blank">https://robotwealth.com/solved-errors-downloading-stock-price-data-yahoo-finance/</a><br /># end
---
author: "Alan Lee"
title: "中文網頁表格擷取,亂碼處理"
tags: ['data process', 'lapply', 'web']
link: "http://rwepa.blogspot.com/2016/09/webcrawlervisualization.html"
highlight: true
---

<div style="color: #222222; font-family: arial, tahoma, helvetica, freesans, sans-serif; margin: 0px; position: relative;"><span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Problem:</span></div><div style="background-color: white; color: #222222; font-family: arial, tahoma, helvetica, freesans, sans-serif; line-height: 18.48px;"><span style="background-color: #cccccc; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: xx-small;"><br /></span></div><span style="background-color: white; color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">本篇文章討論如何使用R下載網頁的表格資料, 再進行後續處理.</span><br /><br /><div style="color: #222222; font-family: arial, tahoma, helvetica, freesans, sans-serif; margin: 0px; position: relative;"><span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Analysis:</span></div><div><h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;"># part 1 設定R語系為C, 以配合中文編碼使用</span></h2></div><span style="background-color: white; color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">本例考量 RWEPA 個人簡介(About) 網頁 (<a href="http://web.ydu.edu.tw/~alan9956/02person.htm" target="_blank">http://web.ydu.edu.tw/~alan9956/02person.htm</a>), 該網頁包括專題演講表格, 該表格包括編號,日期,主題,單位/地點,時數等5個欄位, 在R環境中, 可使用 XML 套件的&nbsp;readHTMLTable 函數讀取網頁表格, 另因中文編碼考量, 先設定 locate, R程式如下:</span><br /><span style="background-color: white; color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;"><br /></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="background-color: white; font-size: 13.2px; line-height: 18.48px;"><span style="color: red;">Sys.setlocale</span><span style="color: #222222;">(category="LC_ALL", locale="C")</span></span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="background-color: white; font-size: 13.2px; line-height: 18.48px;">Sys.getlocale()</span></span><br /><span style="background-color: white;"><span style="font-size: 13.2px; line-height: 18.48px;"><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;"></span></span></span><br /><h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># part 2 載入套件,讀取網頁資料</span></span></h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">準備使用 XML 套件的&nbsp;</span></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">readHTMLTable 函數, 使用時記得加上&nbsp;</span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">&nbsp;</span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">encoding="big5", 結果有5個表格, 其中第1個表格是使用的資料集, 因此將 tmp串列的第1個元素取出, 設定&nbsp;</span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">train &lt;- tmp[[1]]</span><span style="background-color: white; color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;">, R程式如下:</span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;"><br /></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">library(XML) # readHTMLTable 函數</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># IE: F12 --&gt; line 7: &lt;meta http-equiv=Content-Type content="text/html; charset=big5"&gt;&nbsp;</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># 觀察原始網頁採用 big5, 因此encoding參數設定為 big5</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="background-color: white; font-size: 13.2px; line-height: 18.48px;">urls &lt;- "http://web.ydu.edu.tw/~alan9956/02person.htm"</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="background-color: white; font-size: 13.2px; line-height: 18.48px;"><span style="color: #222222;">tmp &lt;- </span><span style="color: red;">readHTMLTable</span><span style="color: #222222;">(urls, stringsAsFactors = FALSE, encoding="big5")</span></span></span><br /><span style="background-color: white;"> <span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">length(tmp) # length=5</span></span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="background-color: white; font-size: 13.2px; line-height: 18.48px;">train &lt;- tmp[[1]] # 139*5</span></span><br /><h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif; font-size: 13.2px; line-height: 18.48px;"># part 3 資料整理</span></h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">train[1,2] # 顯示亂碼</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">iconv(train[1,2], "UTF-8", "BIG-5") # 顯示正常</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># 中文編碼轉換</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"><span style="color: #222222;">train &lt;- as.data.frame(</span><span style="color: red;">lapply</span><span style="color: #222222;">(train, function(x) </span><span style="color: red;">iconv</span><span style="color: #222222;">(x, "UTF-8", "BIG-5")))</span></span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">names(train) &lt;- c("id", "traindate", "program", "location", "hours")</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">head(train)</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># 匯出資料</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">write.table(train, file="C:/rdata/train.txt", row.names=FALSE)</span></span><br /><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># save(train, file="C:/rdata/train.RData") # 亦可儲存成 RData 格式</span></span><br /><h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># R程式:</span></span></h2><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># title: RWEPA - 讀取網頁表格教育訓練</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># date: 2016.9.16</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># part 1 設定R語系為C, 以配合中文編碼使用</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">Sys.setlocale(category="LC_ALL", locale="C")</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">Sys.getlocale()</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># part 2 載入套件,讀取網頁資料</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">library(XML) # readHTMLTable 函數</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># IE: F12 --&gt; line 7: &lt;meta http-equiv=Content-Type content="text/html; charset=big5"&gt;&nbsp;</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># 觀察原始網頁採用 big5, 因此encoding參數設定為 big5</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">urls &lt;- "http://web.ydu.edu.tw/~alan9956/02person.htm"</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">tmp &lt;- readHTMLTable(urls, stringsAsFactors = FALSE, encoding="big5")</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">length(tmp) # length=5</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">train &lt;- tmp[[1]] # 139*5</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># part 3 資料整理</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">train[1,2] # 顯示亂碼</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">iconv(train[1,2], "UTF-8", "BIG-5") # 顯示正常</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># 中文編碼轉換</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">train &lt;- as.data.frame(lapply(train, function(x) iconv(x, "UTF-8", "BIG-5")))</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">names(train) &lt;- c("id", "traindate", "program", "location", "hours")</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">head(train)</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># 匯出資料</span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;">write.table(train, file="C:/rdata/train.txt", row.names=FALSE)</span></span><br /><span style="line-height: 18.48px;"><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small; line-height: 18.48px;"></span></span><br /><span style="color: #222222; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><span style="line-height: 18.48px;"># save(train, file="C:/rdata/train.RData") # 亦可儲存成 RData 格式</span></span><br /><h2><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;">R程式執行結果:</span></span></h2><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-0SmQWKhPCzw/V9zy0Gi7YbI/AAAAAAAAKtY/h6D94_uNgtgrNb6Wg1N7KKzH10CsyMdcgCLcB/s1600/training.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="https://3.bp.blogspot.com/-0SmQWKhPCzw/V9zy0Gi7YbI/AAAAAAAAKtY/h6D94_uNgtgrNb6Wg1N7KKzH10CsyMdcgCLcB/s640/training.png" width="640" /></a></div><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"><br /></span></span><span style="color: #222222; font-family: &quot;arial&quot; , &quot;tahoma&quot; , &quot;helvetica&quot; , &quot;freesans&quot; , sans-serif;"><span style="font-size: 13.2px; line-height: 18.48px;"># end </span></span>